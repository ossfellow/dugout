name: Bootstrap Test Environment

on:
  workflow_dispatch:
    inputs:
      target-repo:
        required: true
        type: string
        description: "GitHub repository to test (e.g., {owner}/{repo})"
        default: "wasmCloud/wasmcloud"
      github-assets:
        required: true
        type: string
        description: 'JSON array of workflows and actions to test (e.g.: ["workflows/provider.yml","actions/artifact-attestation/action.yml"])'
        default: '["workflows/wasmcloud.yml","workflows/provider.yml","actions/artifact-attestation/action.yml","actions/oci-transformations/action.yml","actions/sbom-generation/action.yml","actions/publish-sboms-and-attestations/action.yml"]'
      test-workflow:
        required: true
        type: string
        description: "Name of the workflow to trigger for testing"
        default: "wasmcloud"

jobs:
  bootstrap:
    runs-on: ubuntu-22.04
    steps:
      # Only checkout dugout repository
      - name: Checkout dugout repository
        uses: actions/checkout@v4
        with:
          path: dugout

      # Use the local action to setup test environment
      - uses: ./dugout/.github/actions/workflow-change-validation-checkout
        with:
          target-repo: ${{ inputs.target-repo }}
          github-assets: ${{ inputs.github-assets }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

      # Trigger test workflow
      - name: Trigger test workflow
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: '${{ inputs.test-workflow }}.yml',
              ref: context.ref
            })
